# Render service definition - deploy-time migration (example)
# Adjust names/region/plan as needed in your Render dashboard.
services:
  - type: web
    name: omamori-api
    env: docker
    # Use the backend Dockerfile to build the API image
    dockerfilePath: backend/Dockerfile
    # Run DB migrations before starting the service
    releaseCommand: bash -lc "bundle exec rails db:migrate"
    # Start command for the Rails app (adjust if you use a different server)
    startCommand: bash -lc "bundle exec puma -C config/puma.rb"
    # Optional: set the region and plan according to your account
    # region: oregon
    # plan: starter

jobs:
  - type: job
    name: omamori-migrate
    env: docker
    dockerfilePath: backend/Dockerfile
    # Run migrations manually from the Render dashboard (Run Job)
    command: bash -lc "bundle exec rails db:migrate"
